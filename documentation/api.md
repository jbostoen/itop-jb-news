
# Evolution of the API

Where possible, the news server API will try to respond with a backward compatible response.  
Servers should not provide a newer response than what is requested by the client.  
Clients might not be able to process newer structures anyway.

# Messages

Below you'll find example outputs of a server response to a client that has requested news messages.

Clients offer no backward compatibility.  
Servers should offer backward compatibility where available, or respond with a non-HTTP 200 status code.

## Version 1.2.0

A basic token system (per news source) has been implemented for each operation.   
Despite "unique" identifiers (database UID, instance UID, environment), a complete environment may have been cloned.  
This token-based system allows to uniquely identify those instances.

* The client will now send a `token` in the payload for any request. If it's the first time, a random token (200 characters) will be generated by the client.
* The server should send a `refresh_token` in the response.
* This token is immediately saved by the client for the next request.
* The structure of the data always remains the same now, also when signing is not applicable.
* `encryption_library` has been renamed to `crypto_lib` and its value is now lowercase.


In the past, clients could specify a preference (Sodium cryptography) to the server.  
However, they would still process unsigned responses. 
The latest version of the client will ignore unsigned responses if cryptography was explicitly requested.

```
{
	"crypto_lib": "sodium",
	"messages": [
		{
			"thirdparty_message_id": "jb-20250704-portal",
			"title": "Support portal launched!",
			"icon": {
				"data": "",
				"mimetype": "",
				"filename": ""
			},
			"start_date": "2025-07-04 00:00:00",
			"end_date": null,
			"priority": "1",
			"oql": "SELECT User",
			"translations_list": [
				{
					"language": "EN US",
					"title": "Support portal launched!",
					"text": "As of today, there's a support portal where you can find all downloads, tickets, invoices and more!",
					"url": "https://support.jeffreybostoen.be"
				}
			]
		}
	],
	"signature": "85e4ZQKJq-Pe-qH0C9XfOt0AoLKLL-t896ATKqEdMd45xwTIon-DxNaNge8MDqv8SHj7W_JcJnUpXZMorN8tAw==",
    "refresh_token": "",
}
```


## Version 1.1.0

* `target_profiles` has been deprecated and removed.  
  It has been replaced by the more functional `oql` that can be specified to target an audience.
* The API version also contains a 'minor release' version number now, so small changes can be implemented more easily.
* Introduction of `operation` parameter. Currently two operations are supported: `get_messages_for_instance`, `report_read_statistics`.


```
{
	"encryption_library": "Sodium",
	"messages": [
		{
			"thirdparty_message_id": "jb-20250704-portal",
			"title": "Support portal launched!",
			"icon": {
				"data": "",
				"mimetype": "",
				"filename": ""
			},
			"start_date": "2025-07-04 00:00:00",
			"end_date": null,
			"priority": "1",
			"oql": "SELECT User",
			"translations_list": [
				{
					"language": "EN US",
					"title": "Support portal launched!",
					"text": "As of today, there's a support portal where you can find all downloads, tickets, invoices and more!",
					"url": "https://support.jeffreybostoen.be"
				}
			]
		}
	],
	"signature": "85e4ZQKJq-Pe-qH0C9XfOt0AoLKLL-t896ATKqEdMd45xwTIon-DxNaNge8MDqv8SHj7W_JcJnUpXZMorN8tAw=="
}
```

If no encryption library was specified in the client request, a regular JSON array will be returned (the contents of "messages" above).


## Version 1.0

This returned a JSON response.

If the client request to the server indicated support for Sodium, the response was similar to:

```
{
	"encryption_library": "Sodium",
	"messages": [
		{
			"thirdparty_message_id": "jb-20220704-portal",
			"title": "Support portal launched!",
			"icon": {
				"data": "",
				"mimetype": "",
				"filename": ""
			},
			"start_date": "2022-07-04 00:00:00",
			"end_date": null,
			"priority": "1",
			"target_profiles": "Administrator",
			"translations_list": [
				{
					"language": "EN US",
					"title": "Support portal launched!",
					"text": "As of today, there's a support portal where you can find all downloads, tickets, invoices and more!",
					"url": "https://support.jeffreybostoen.be"
				}
			]
		}
	],
	"signature": "85e4ZQKJq-Pe-qH0C9XfOt0AoLKLL-t896ATKqEdMd45xwTIon-DxNaNge8MDqv8SHj7W_JcJnUpXZMorN8tAw=="
}
```

If no encryption library was specified in the client request, a regular JSON array will be returned (the contents of "messages" above).
